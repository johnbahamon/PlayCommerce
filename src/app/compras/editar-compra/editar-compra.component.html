<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">Editar compra</h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <div class="btn-group mr-2">
      <button routerLink="/compras" class="btn btn-sm btn-outline-secondary">Compras</button>
    </div>
  </div>
</div>

<div class="container" *ngIf="invoice">

  <div class="row justify-content-around">
    <div class="col-5">
      <div class="row">
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text" id="basic-addon1">Fecha de Proveedor</span>
          </div>
          <input type="text" class="form-control" [value]="invoice.supplierDate | date" readonly>
        </div>
      </div>
    </div>
    <div class="col-5">
      <div class="row" *ngIf="invoice.dueDate">
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text" id="basic-addon1">Fecha de Vencimiento</span>
          </div>
          <input type="text" class="form-control" [value]="invoice.dueDate | date" readonly>
        </div>
      </div>
    </div>
  </div>

  <div class="row justify-content-around">
    <div class="col-5">
      <div class="row">
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text" id="basic-addon1">Proveedor</span>
          </div>
          <input *ngIf="invoice.supplier.tipoId === 'nit'" type="text" class="form-control"
            [value]="invoice.supplier.primerNombre" readonly>
          <input *ngIf="invoice.supplier.tipoId === 'cc'" type="text" class="form-control"
            [value]="invoice.supplier.primerNombre + invoice.supplier.segundoNombre + invoice.supplier.apellidos"
            readonly>
        </div>
      </div>
    </div>
    <div class="col-5">
      <div class="row">
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text" id="basic-addon1">Factura Proveedor</span>
          </div>
          <input type="text" class="form-control" [value]="invoice.supplierNumber" readonly>
        </div>
      </div>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th style="width: 5%">#</th>
          <th style="width: 31%">Producto</th>
          <th style="width: 8%">Cant.</th>
          <th style="width: 10%">Vr Unit.</th>
          <th style="width: 8%">Desc. 1 (%)</th>
          <th style="width: 8%">Desc. 2 (%)</th>
          <!-- <th style="width: 10%">Iva (%)</th> -->
          <th style="width: 10%">Neto</th>
          <th style="width: 10%">+Iva</th>
          <th style="width: 10%">+IvaUnit</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of productosElegidos; trackBy: trackByProductId; let i = index">
          <td><input class="form-control" type="text" readonly value="{{ i + 1 }}"></td>
          <td>
            <!-- <div class="input-group">
              <input class="form-control" type="text" readonly value="{{ product.productId.nombre }}">
              <div class="input-group-append">
                <button (click)="eliminarProducto(i)" class="btn btn-outline-secondary" type="button">X</button>
              </div>
            </div> -->

            <div class="row">
              <div class="col-8">
                <p>
                  {{ product.productName }}
                </p>
              </div>
              <div class="col-2">
                <button (click)="eliminarProducto(i)" class="btn btn-outline-secondary">X</button>
              </div>
              <div class="col-2"></div>
            </div>
          </td>
          <td>
            <input class="form-control" (keyup)="actualizar($event)" type="number" min="0" [(ngModel)]="product.qty"
              [ngModelOptions]="{standalone: true}">
          </td>
          <td>
            <input class="form-control" (keyup)="actualizar($event)" type="number" min="0"
              [(ngModel)]="product.unitValue" [ngModelOptions]="{standalone: true}">
          </td>
          <td>
            <input class="form-control" (keyup)="actualizar($event)" type="number" min="0" max="100"
              [(ngModel)]="product.discount" [ngModelOptions]="{standalone: true}">
          </td>
          <td>
            <input class="form-control" (keyup)="actualizar($event)" type="number" min="0" max="100"
              [(ngModel)]="product.discount2" [ngModelOptions]="{standalone: true}">
          </td>
          <td>
            <!-- <input class="form-control" type="number" readonly [(ngModel)]="product.tax"
              [ngModelOptions]="{standalone: true}"> -->
              <input class="form-control" type="number" readonly value="{{ this.Math.round(product.withTax / 1.19) }}">
          </td>
          <td>
            <input class="form-control" type="number" readonly [(ngModel)]="product.withTax"
              [ngModelOptions]="{standalone: true}"
              value="{{ this.Math.round( 1.19 * ( product.qty * product.unitValue ) * ( 1 - ( product.discount / 100 ) ) * ( 1 - ( product.discount2 / 100 ) ) ) }}">
          </td>
          <td>
            <!-- <input class="form-control" type="number" [(ngModel)]="product.withTaxUnit" name="product.withTaxUnit" value="{{ this.Math.round( 1.19 * ( product.qty * product.unitValue ) * ( 1 - ( product.discount / 100 ) ) * ( 1 - ( product.discount2 / 100 ) ) ) }}"> -->
            <input class="form-control" type="number" readonly [(ngModel)]="product.withTaxUnit"
              [ngModelOptions]="{standalone: true}"
              value="{{ this.Math.round(( 1.19 * ( product.qty * product.unitValue ) * ( 1 - ( product.discount / 100 ) ) * ( 1 - ( product.discount2 / 100 ) ) ) / product.qty ) }}">
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  


</div>

<div>
  <div>
    <div>
      <input #searchProd type="text" class="form-control" placeholder="Buscar Productos por Referencia"
        [(ngModel)]="productSearch" [ngModelOptions]="{standalone: true}">
      <ul #suggestionsProducts [style.display]=" productosEncontrados.length> 0 ? 'block' : 'none'">
        <li *ngFor="let producto of productosEncontrados">
          {{ producto.caracteristicas.referencia }} - {{ producto.nombre }}
          <button type="button" class="btn btn-link" (click)="elegirProducto(producto)">Elegir Producto</button>
        </li>
      </ul>
    </div>
    <br>
    <div class="container">
      <div class="row">
        <div class="col-6"></div>
        <div class="col-4">
          <div class="form-group row">
            <label for="" class="col-6 text-right">
              <h5>Total Bruto:</h5>
            </label>
            <div class="col-5">
              <input class="form-control" type="number" readonly [(ngModel)]="grossTotal"
                [ngModelOptions]="{standalone: true}">
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-6"></div>
        <div class="col-4">
          <div class="form-group row">
            <label for="" class="col-6 text-right">
              <h5>Descuentos:</h5>
            </label>
            <div class="col-5">
              <input class="form-control" type="number" readonly [(ngModel)]="discounts"
                [ngModelOptions]="{standalone: true}">
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-6"></div>
        <div class="col-4">
          <div class="form-group row">
            <label for="" class="col-6 text-right">
              <h5>Subtotal:</h5>
            </label>
            <div class="col-5">
              <input class="form-control" type="number" readonly [(ngModel)]="subtotal"
                [ngModelOptions]="{standalone: true}">
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-6"></div>
        <div class="col-4">
          <div class="form-group row">
            <label for="" class="col-6 text-right">
              <h5>Iva:</h5>
            </label>
            <div class="col-5">
              <input class="form-control" type="number" readonly [(ngModel)]="iva"
                [ngModelOptions]="{standalone: true}">
            </div>
          </div>
        </div>
      </div>
      <!-- <hr> -->
      <div class="row">
        <div class="col-6"></div>
        <div class="col-4">
          <div class="form-group row">
            <label for="" class="col-6 text-right">
              <h5>Total Neto:</h5>
            </label>
            <div class="col-5">
              <input class="form-control" type="number" readonly [(ngModel)]="total"
                [ngModelOptions]="{standalone: true}">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <button type="submit" class="btn btn-primary" (click)="prueba()">Submit</button>
</div>